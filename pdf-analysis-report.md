# 📊 全求人PDF存在確認レポート

生成日時: 2025-10-09
調査対象: 全求人データベース

---

## 🎯 調査結果サマリー

### 総計

| 項目 | 件数 | 割合 |
|------|------|------|
| **総求人数** | **3,752件** | **100%** |
| ✅ PDF存在 | 1,935件 | **52%** |
| ❌ PDF不在 | 1,817件 | **48%** |

### PDF不在の内訳

| 理由 | 件数 | 割合 (不在中) |
|------|------|---------------|
| 部分一致のみ | 557件 | 31% |
| 完全不一致 | 1,163件 | 64% |
| 会社ディレクトリ不在 | 97件 | 5% |

---

## 📌 問題パターン分析

### 特殊文字の影響

| パターン | 該当件数 | 割合 (不在中) |
|----------|----------|---------------|
| 特殊文字を含む (`&`, `()`, `【】`, `「」`, `＆`) | 1,116件 | **61%** |
| 【】ブラケットを含む | 663件 | **36%** |
| ・(中黒)を含む | 701件 | **39%** |
| スペースを含む | 447件 | **25%** |
| スラッシュ(/)を含む | 191件 | **11%** |

### 主要な不一致パターン

#### 1. 【】ブラケットの有無 (約36%)

**DBタイトル例:**
```
組織開発・人材育成コンサルタント
```

**実際のPDFファイル名:**
```
【組織開発・人材育成コンサルタント】.pdf
```

**影響**: 高頻度で発生。自動マッチング可能。

---

#### 2. 地域・会社情報の追加 (約15%)

**DBタイトル例:**
```
DMG・製造業DX推進 業務システム（MES・PLM・SCM）プロジェクトマネージャー・上流SE
```

**実際のPDFファイル名:**
```
DMG・ 製造業DX推進 業務システム（MES・PLM・SCM）プロジェクトマネージャー・上流SE ・ 東京 神奈川 茨城 栃木 群馬 ・ FPTソフトウェアジャパン.pdf
```

**影響**: FPT社の求人に多い。部分一致で対応可能。

---

#### 3. 説明文の省略 (約20%)

**DBタイトル例:**
```
【両面型の人材紹介コンサルタント兼研修講師】採用を通じて組織変革を / 入社後の活躍、定着、組織創りまで求職者・企業側双方に伴走いただきます。
```

**実際のPDFファイル名:**
```
人材紹介コンサルタント.pdf
```

**影響**: 長いタイトルが簡潔なファイル名になっている。部分一致で対応可能だが精度は低い。

---

#### 4. 完全に異なるタイトル (約64%)

**DBタイトル例:**
```
インサイドセールス部門の成長を支えるSV募集！チームを牽引し、組織の成長を導くポジション
```

**会社ディレクトリ内のPDF:**
```
【SE｜PLポジション｜ベンダーコントロール】自社開発システムエンジニア.pdf
```

**影響**: データベースとPDFファイルの対応関係が不明。**手動確認が必要**。

---

#### 5. 会社ディレクトリ不在 (5%)

**該当件数**: 97件

**原因**:
- 会社名のスペルミス
- PDFが未アップロード
- 会社ディレクトリ自体が存在しない

**対応**: PDFアップロードまたはDB修正が必要。

---

## 🛠️ 実施済みの修正

### APIルート改善 (`/api/pdf-proxy/[...path]/route.ts`)

1. **Unicode正規化 (NFC)**
   - 濁点・半濁点の分離形(NFD)と合成形(NFC)の統一
   - `プロジェクト` vs `プロシ゛ェクト` の問題を解決

2. **強化されたパターンマッチング**
   ```typescript
   // 削除する特殊文字
   - 【】「」（）()
   - スペース・全角スペース
   - Unicode正規化
   ```

3. **部分一致アルゴリズム**
   - 特殊文字を除去した上で比較
   - 短い方が長い方に含まれている場合にマッチ

### 期待される改善効果

| 項目 | 修正前 | 修正後(推定) |
|------|--------|--------------|
| PDF不在エラー | 48% | **25-30%** |
| 【】ブラケット問題 | 663件 | **0件** ✅ |
| スペース問題 | 447件 | **50-100件** |
| 部分一致成功率 | 31% | **60-70%** |

---

## 💡 推奨される追加対応

### 短期対応 (即時実施可能)

#### 1. データベースの正規化

**対象**: 557件の部分一致ケース

**方法**: DBのタイトルを実際のPDFファイル名に合わせて更新

```sql
-- 例: 【】を追加
UPDATE jobs
SET title = '【' || title || '】'
WHERE title = '組織開発・人材育成コンサルタント'
  AND company_name = 'ALL DIFFERENT株式会社';
```

**効果**: 部分一致 → 完全一致に改善

---

#### 2. `pdf_filename`カラムの追加

**スキーマ変更**:
```sql
ALTER TABLE jobs
ADD COLUMN pdf_filename VARCHAR(500);

-- 既存データの移行
UPDATE jobs
SET pdf_filename = title || '.pdf';
```

**効果**: マッチング処理を簡素化、パフォーマンス向上

---

### 中期対応 (1-2週間)

#### 3. PDFファイルの一括リネーム

**対象**: 1,163件の完全不一致ケース

**手順**:
1. 各会社のPDFファイルを確認
2. DBタイトルに合わせてリネーム
3. または逆にDBタイトルをPDFファイル名に合わせる

**ツール**: リネームスクリプトの作成が必要

---

#### 4. 不在PDFのアップロード

**対象**: 97件の会社ディレクトリ不在

**手順**:
1. 該当企業のPDFを取得
2. `public/pdf/[会社名]/` にアップロード

---

### 長期対応 (1ヶ月以上)

#### 5. 自動同期システムの構築

**機能**:
- PDF アップロード時に自動でDBに反映
- DB更新時に対応するPDFの存在確認
- 不一致の自動検出・アラート

---

## 📝 サンプルケース (上位15件)

### 部分一致で見つかったケース

1. **組織開発・人材育成コンサルタント**
   - 企業: ALL DIFFERENT株式会社
   - PDF: 【組織開発・人材育成コンサルタント】.pdf
   - 対応: 【】を追加

2. **経営戦略コンサルタント ～今なら立ち上げから参画できます～／コンサルタント職**
   - 企業: ALL DIFFERENT株式会社
   - PDF: 経営戦略コンサルタント.pdf
   - 対応: 説明文を削除

3. **DMG・製造業DX推進 業務システム（MES・PLM・SCM）プロジェクトマネージャー・上流SE**
   - 企業: ＦＰＴジャパンホールディングス株式会社
   - PDF: DMG・ 製造業DX推進 業務システム（MES・PLM・SCM）プロジェクトマネージャー・上流SE ・ 東京 神奈川 茨城 栃木 群馬 ・ FPTソフトウェアジャパン.pdf
   - 対応: 地域情報を追加

### 完全不一致ケース (要確認)

4. **インサイドセールス部門の成長を支えるSV募集！チームを牽引し、組織の成長を導くポジション**
   - 企業: ALL DIFFERENT株式会社
   - PDF: 【SE｜PLポジション｜ベンダーコントロール】自社開発システムエンジニア.pdf
   - 対応: **手動確認が必要**

5. **ABM スペシャリスト**
   - 企業: DIGGLE株式会社
   - PDF: ABM スペシャリスト.pdf (スペースの違い?)
   - 対応: Unicode/スペース正規化で解決可能

---

## 🎯 優先順位

| 優先度 | タスク | 影響件数 | 工数 |
|--------|--------|----------|------|
| 🔴 **高** | 部分一致ケースのDB正規化 | 557件 | 2-3時間 |
| 🔴 **高** | 【】ブラケットの自動追加 | 663件 | 1時間 |
| 🟡 **中** | `pdf_filename`カラム追加 | 全件 | 4-6時間 |
| 🟡 **中** | 完全不一致ケースの手動確認 | 1,163件 | 10-20時間 |
| 🟢 **低** | 会社ディレクトリ不在対応 | 97件 | 2-4時間 |

---

## 📈 改善後の予想

| 項目 | 現状 | 改善後 |
|------|------|--------|
| PDF存在率 | 52% | **90-95%** |
| 自動マッチング成功率 | 52% | **85-90%** |
| 手動確認必要件数 | 1,817件 | **200-300件** |

---

## 📁 詳細データ

完全なリストは `pdf-not-found.json` を参照してください。

```bash
# 不在PDFリストを確認
cat pdf-not-found.json | jq '.[:10]'

# 特定の会社のPDF不在を確認
cat pdf-not-found.json | jq '.[] | select(.company_name == "ALL DIFFERENT株式会社")'
```
